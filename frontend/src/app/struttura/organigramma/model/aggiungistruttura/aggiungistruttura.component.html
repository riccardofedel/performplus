<div class="modal-header">
  <h5 class="modal-title" id="exampleModalLabel">
    <span *ngIf="id !== undefined">{{ "modifica struttura" | translate }}</span>
    <span *ngIf="idPadre !== undefined">{{
      "aggiungi struttura" | translate
    }}</span>
  </h5>
  <button
    type="button"
    class="close"
    (click)="activeModal.close()"
    aria-label="Close"
  >
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="modal-body">
  <span class="loading" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="sr-only"></span>
    </div>
  </span>

  <div class="" *ngIf="!loading && creaForm">
    <form [formGroup]="creaForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <div class="col-md-12 mb-3">
          <label for="codice">{{ "codice" | translate }} *</label>
          {{ codiceCompleto }}
          <input
            id="codice"
            type="text"
            class="form-control form-control-border"
            formControlName="codice"
            placeholder="{{ 'codice' | translate }}"
            [ngClass]="{ 'is-invalid': f.codice.errors }"
          />
        </div>
        <div class="col-md-12 mb-3">
          <label for="intestazione">{{ "intestazione" | translate }} *</label>
          <input
            id="intestazione"
            class="form-control form-control-border"
            type="text"
            formControlName="intestazione"
            placeholder="{{ 'intestazione' | translate }}"
            [ngClass]="{ 'is-invalid': f.intestazione.errors }"
          />
        </div>
        <div class="col-md-6 mb-3" >
          <label class="custom-control-label" for="tipologiaStruttura">{{
            "tipologiaStruttura" | translate
          }}</label>
         <ng-select [ngClass]="{ 'is-invalid': !f.tipologiaStruttura.value }"
            id="tipologiaStruttura" [items]="tipologie" [searchable]="false"
            [clearable]="true" bindLabel="descrizione" bindValue="codice"
            formControlName="tipologiaStruttura" placeholder=" ">
            <ng-template ng-option-tmp let-item="item">
              <label>{{item.descrizione}}</label>
            </ng-template>
            <ng-template ng-label-tmp let-item="item">
              <span>{{item.descrizione}}</span>
            </ng-template>
          </ng-select>
        </div>
        <div class="col-md-6 mb-3" >
          <label class="custom-control-label" for="tipoStruttura">{{
            "tipoStruttura" | translate
          }}</label>
         <ng-select [ngClass]="{ 'is-invalid': !f.tipoStruttura.value }"
            id="tipoStruttura" [items]="tipi" [searchable]="false"
            [clearable]="true" bindLabel="descrizione" bindValue="codice"
            formControlName="tipoStruttura" placeholder=" ">
            <ng-template ng-option-tmp let-item="item">
              <label>{{item.descrizione}}</label>
            </ng-template>
            <ng-template ng-label-tmp let-item="item">
              <span>{{item.descrizione}}</span>
            </ng-template>
          </ng-select>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-control-placeholder-select" for="idResponsabile"
            >{{ "responsabile" | translate }} *</label
          >

          <ng-autocomplete
            style="width: 100%"
            [ngClass]="{ 'is-invalid': !f.idResponsabile.value }"
            class="form-control"
            formControlName="idResponsabile"
            [data]="responsabili"
            [isLoading]="isLoadingResult"
            [minQueryLength]="0"
            placeholder="Cerca per cognome"
            [searchKeyword]="keyword"
            (inputChanged)="onChangeSearch($event)"
            [itemTemplate]="itemTemplate"
            [notFoundTemplate]="notFoundTemplate"
          >
          </ng-autocomplete>

          <ng-template #itemTemplate let-item>
            <a [innerHTML]="item.description"></a>
          </ng-template>

          <ng-template #notFoundTemplate let-notFound>
            <div [innerHTML]="notFound"></div>
          </ng-template>

          <!--
          <ng-select [ngClass]="{ 'is-invalid': !f.responsabile.value }"
            id="responsabile" [items]="responsabili" [searchable]="false"
            [clearable]="false" bindLabel="descrizione" bindValue="id"
            formControlName="responsabile" placeholder=" ">
            <ng-template ng-option-tmp let-item="item">
              <label>{{item.descrizione}}</label>
            </ng-template>
            <ng-template ng-label-tmp let-item="item">
              <span>{{item.descrizione}}</span>
            </ng-template>
          </ng-select>
    -->
        </div>

        <div class="col-md-6 mb-3">
          <label for="codiceInterno">{{ "codice interno" | translate }}</label>
          <input
            id="codiceInterno"
            class="form-control form-control-border"
            type="text"
            formControlName="codiceInterno"
            placeholder="{{ 'codice interno' | translate }}"
            [ngClass]="{ 'is-invalid': f.codiceInterno.errors }"
          />
        </div>
        
        <div class="col-md-12 mb-3">
          <label for="descrizione">{{ "descrizione" | translate }}</label>
          <textarea
            id="descrizione"
            class="form-control form-control-border"
            type="text"
            formControlName="descrizione"
            placeholder="{{ 'descrizione' | translate }}"
            [ngClass]="{ 'is-invalid': f.descrizione.errors }"
          ></textarea>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-control-placeholder-select" for="inizioValidita"
            >{{ "inizio" | translate }} *</label
          >
          <div class="input-group">
            <input
              id="inizioValidita"
              class="datepicker form-control"
              placeholder=""
              name="inizioValidita"
              formControlName="inizioValidita"
              type="date"
            />
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label class="form-control-placeholder-select" for="fineValidita"
            >{{ "fine" | translate }} *</label
          >
          <div class="input-group">
            <input
              id="fineValidita"
              class="datepicker form-control"
              placeholder=""
              name="fineValidita"
              formControlName="fineValidita"
              type="date"
            />
          </div>
        </div>
        <div class="col-md-12 mb-3">
          <button [disabled]="creaForm.invalid" class="btn btn-primary">
            {{ "salva" | translate }}</button
          >&nbsp;
          <a
            (click)="activeModal.close()"
            type="button"
            class="btn btn-secondary"
            >{{ "annulla" | translate }}</a
          >
        </div>
      </div>
    </form>
  </div>
</div>
