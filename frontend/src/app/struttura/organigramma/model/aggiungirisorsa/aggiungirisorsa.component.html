<div class="modal-header">
  <h5 class="modal-title">
    <span>{{'aggiungi risorsa alla struttura'|translate}}</span>
  </h5>
  <button type="button" class="close" (click)="activeModal.close()" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="modal-body">

  <span class="loading" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="sr-only"></span>
    </div>
  </span>

  <div class="" *ngIf="!loading && cercaForm">

    <form [formGroup]="cercaForm" (ngSubmit)="onSubmit()">

      <div class="row">
          <div class="col-md-2">
            <div class="input-group mb-3">

              <ng-autocomplete
              class="form-control"
              formControlName="cerca"
              [data]="cognomi"
              [isLoading]="isLoadingResult"
              placeholder="Cognome"
              [searchKeyword]="keyword"
              (inputChanged)='onChangeSearch($event)'
              [itemTemplate]="itemTemplate"
              [notFoundTemplate]="notFoundTemplate">
              </ng-autocomplete>

              <ng-template #itemTemplate let-item>
              <a [innerHTML]="item.description"></a>
              </ng-template>

              <ng-template #notFoundTemplate let-notFound>
              <div [innerHTML]="notFound"></div>
              </ng-template>

              <button class="btn btn-primary" type="submit">
                <i-bs name="search" width="1.5rem" height="1.5rem"></i-bs>
              </button>
            </div>
          </div>


      </div>
    </form>

<table
      class="table align-middle table-responsive table-big"
      *ngIf="!loading"
    >
      <thead>
        <tr>
          <th scope="col">
            {{ "selezionati" | translate }}: {{ selezionato.length }}
          </th>
          <th scope="col">{{ "risorsa umana" | translate }}</th>
          <th scope="col">{{ "codice" | translate }}</th>
          <th scope="col">{{ "categoria" | translate }}</th>
          <!-- <th scope="col">{{ "codice fiscale" | translate }}</th> -->
          <th scope="col">{{ "email" | translate }}</th>
          <th scope="col">{{ "inizio" | translate }}</th>
          <th scope="col">{{ "fine" | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let risorsa of risorse; let i = index">
          <td class="text-center">
            <button
              class="btn btn-icon"
              (click)="toggleSeleziona(risorsa.id!)"
              title="{{ 'seleziona/deseleziona' | translate }}"
            >
              <i-bs
                name="check-square"
                width="1.5rem"
                height="1.5rem"
                *ngIf="isSelezionato(risorsa.id!)"
              ></i-bs>
              <i-bs
                name="square"
                width="1.5rem"
                height="1.5rem"
                *ngIf="!isSelezionato(risorsa.id!)"
              ></i-bs>
            </button>
          </td>
          <td>{{ risorsa.cognome }} {{ risorsa.nome }} </td>
          <td>{{ risorsa.codiceInterno }}</td>
          <td>{{ risorsa.categoria }}</td>
          <!-- <td>{{ risorsa.codiceFiscale }}</td> -->
          <td>{{ risorsa.email }}</td>
          <td>
            {{ fieldsService.convertDate(risorsa.inizioValidita) }}
          </td>
          <td>
            {{ fieldsService.convertDate(risorsa.fineValidita) }}
          </td>
        </tr>
      </tbody>
    </table>

    <div class="d-flex justify-content-between p-2"></div>

    <pagination
      [paginationService]="paginationService"
      class="flex-shrink-1"
    ></pagination>

    <div class="col-md-12 mb-3 text-end">
      <a
        (click)="activeModal.close()"
        type="button"
        class="btn btn-secondary"
        >{{ "annulla" | translate }}</a>
      &nbsp;
      <button [disabled]="selezionato.length===0" (click)="aggiungiRisorse()" type="button" class="btn btn-primary">
        <i-bs name="plus" width="1.5rem" height="1.5rem"></i-bs>
        {{ "salva" | translate }}</button>
    </div>
  </div>
</div>
